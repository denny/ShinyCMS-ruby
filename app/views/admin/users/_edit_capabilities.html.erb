<br>
<table class="table table-responsive-sm table-striped">
  <tr>
    <th colspan="5">
      <a class="collapse-toggle" role="button" href="#" data-toggle="collapse" data-target=".collapse_capabilities" aria-expanded="true" aria-controls="collapse_capabilities">
        <%= t( 'capability.capabilities' ) %>
        <% if @user.capabilities.present? %>
        <% show = 'show ' %>
        <span class="toggle-icon-top collapse show">
          <svg><use xlink:href="<%= image_path 'coreui/icons/coreui/free-symbol-defs.svg' %>#cui-chevron-top"></use></svg>
        </span>
        <% else %>
        <% show = '' %>
        <span class="toggle-icon-bottom collapse">
          <svg><use xlink:href="<%= image_path 'coreui/icons/coreui/free-symbol-defs.svg' %>#cui-chevron-bottom"></use></svg>
        </span>
        <% end %>
      </a>
    </th>
  </tr>

  <% category = CapabilityCategory.find_by( name: 'general' ) %>
  <% category_capabilities = %i[ view_admin_area view_admin_toolbar skip skip ] %>
  <tr class="<%= show %>collapse collapse_capabilities">
    <td class="shorter">
      <%= t( "capability.category.#{category.name}" ) %>
    </td>
    <% category_capabilities.each do |capability| %>
    <td class="longer">
      <%= render_capability_checkbox( f, capability, category ) %>
    </td>
    <% end %>
  </tr>
<!--
  users = User.arel_table
  User.where(users[:name].matches("%#{user_name}%"))
-->
  <% category_capabilities = %i[ list add edit delete ] %>
  <% CapabilityCategory.where(
      name: %i[ pages page_sections page_templates blogs blog_posts ]
    ).each do |category| %>
  <tr class="<%= show %>collapse collapse_capabilities">
    <td>
      <%= t( "capability.category.#{category.name}" ) %>
    </td>
    <% category_capabilities.each do |capability| %>
    <td>
      <%= render_capability_checkbox( f, capability, category ) %>
    </td>
    <% end %>
  </tr>
  <% end %>

  <% category_capabilities = %i[ change_author skip skip skip ] %>
  <% category = CapabilityCategory.find_by( name: 'blog_posts' ) %>
  <tr class="<%= show %>collapse collapse_capabilities">
    <td>
    </td>
    <% category_capabilities.each do |capability| %>
    <td>
      <%= render_capability_checkbox( f, capability, category ) %>
    </td>
    <% end %>
  </tr>

  <% category_capabilities = %i[ list add edit delete ] %>
  <% category = CapabilityCategory.find_by( name: 'users' ) %>
  <tr class="<%= show %>collapse collapse_capabilities">
    <td>
      <%= t( "capability.category.#{category.name}" ) %>
    </td>
    <% category_capabilities.each do |capability| %>
    <td>
      <%= render_capability_checkbox( f, capability, category ) %>
    </td>
    <% end %>
  </tr>
  <% category_capabilities = %i[ view_admin_notes skip skip skip ] %>
  <tr class="<%= show %>collapse collapse_capabilities">
    <td>
    </td>
    <% category_capabilities.each do |capability| %>
    <td>
      <%= render_capability_checkbox( f, capability, category ) %>
    </td>
    <% end %>
  </tr>

  <% category_capabilities = %i[ list add edit delete ] %>
  <% category = CapabilityCategory.find_by( name: 'admin_users' ) %>
  <tr class="<%= show %>collapse collapse_capabilities">
    <td>
      <%= t( "capability.category.#{category.name}" ) %>
    </td>
    <% category_capabilities.each do |capability| %>
    <td>
      <%= render_capability_checkbox( f, capability, category ) %>
    </td>
    <% end %>
  </tr>
</table>

<% @page_title = t( '.edit_user' ) %>

<%= form_for @user, url: admin_user_path( @user ), method: :post do |f| %>
  <p>
    <%= f.label :username %>
    <br><%= f.text_field :username %>
  </p>
  <p>
    <%= f.label :display_name %>
    <br><%= f.text_field :display_name %>
  </p>

  <p>
    <%= f.label :email %>
    <br><%= f.text_field :email %>
  </p>
  <p>
    <%= f.label :display_email %>
    <br><%= f.text_field :display_email %>
  </p>

  <p>
    <%= f.label :password %>
    <br><%= f.text_field :password %>
  </p>

  <p>
    <%= f.label :profile_pic %>
    <br><%= f.file_field :profile_pic %>
    <% if @user.profile_pic.present? %>
    <br><%= image_tag @user.profile_pic.variant( resize: '200x200!' ).processed.service_url, class: 'user_icon' %>
    <% end %>
  </p>

  <p>
    <%= f.label :bio %>
    <br><%= f.text_area :bio %>
  </p>

  <p>
    <%= f.label :location %>
    <br><%= f.text_field :location %>
  </p>
  <p>
    <%= f.label :postcode %>
    <br><%= f.text_field :postcode %>
  </p>

  <% if current_user_can? :edit, :admin_users %>
  <br>
  <table class="table table-responsive-sm table-striped">
    <tr>
      <th colspan="5">
        <%= t( 'capability.capabilities' ) %>
      </th>
    </tr>
    <% category = CapabilityCategory.find_by( name: 'general' ) %>
    <tr>
      <td>
        <%= t( "capability.category.#{category.name}" ) %>
      </td>
      <% %i[ view_admin_area view_admin_toolbar ].each do |capability| %>
      <td colspan="2">
        <% c = Capability.find_by( name: capability, category: category ) %>
        <% if c.present? %>
        <label>
          <input type="checkbox" name="capabilities" value="<%= c.id %>"<% if @user.can?(
            c.name.to_sym, c.category.name.to_sym ) %> checked="checked"<% end %>>
          <%= t( "capability.general.#{c.name}" ) %>
        </label>
        <% end %>
      </td>
      <% end %>
    </tr>
    <% CapabilityCategory.all.order( :id ).each do |category| %>
    <% next if %w[ general admin_users ].include? category.name %>
    <tr>
      <td>
        <%= t( "capability.category.#{category.name}" ) %>
      </td>
      <% %i[ list add edit delete ].each do |capability| %>
      <td>
        <% c = Capability.find_by( name: capability, category: category ) %>
        <% if c.present? %>
        <label>
          <input type="checkbox" name="capabilities" value="<%= c.id %>"<% if @user.can?(
            c.name.to_sym, c.category.name.to_sym ) %> checked="checked"<% end %>>
          <%= t( c.name ) %>
        </label>
        <% end %>
      </td>
      <% end %>
    </tr>
    <% end %>
    <% category = CapabilityCategory.find_by( name: 'users' ) %>
    <tr>
      <td>
      </td>
      <% capability = 'view_admin_notes' %>
      <td colspan="4">
        <% c = Capability.find_by( name: capability, category: category ) %>
        <% if c.present? %>
        <label>
          <input type="checkbox" name="capabilities" value="<%= c.id %>"<% if @user.can?(
            c.name.to_sym, c.category.name.to_sym ) %> checked="checked"<% end %>>
          <%= t( "capability.users.#{c.name}" ) %>
        </label>
        <% end %>
      </td>
    </tr>
    <% category = CapabilityCategory.find_by( name: 'admin_users' ) %>
    <tr>
      <td>
        <%= t( "capability.category.#{category.name}" ) %>
      </td>
      <% %i[ list add edit delete ].each do |capability| %>
      <td>
        <% c = Capability.find_by( name: capability, category: category ) %>
        <% if c.present? %>
        <label>
          <input type="checkbox" name="capabilities" value="<%= c.id %>"<% if @user.can?(
            c.name.to_sym, c.category.name.to_sym ) %> checked="checked"<% end %>>
          <%= t( c.name ) %>
        </label>
        <% end %>
      </td>
      <% end %>
    </tr>
  </table>
  <% end %>

  <p>
    <%= f.label :admin_notes %>
    <br><%= f.text_area :admin_notes %>
  </p>

  <p class="form_buttons">
    <%= submit_tag t( 'update' ) %>
  </p>
<% end %>

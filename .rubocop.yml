# ShinyCMS ~ https://shinycms.org
#
# Copyright 2009-2020 Denny de la Haye ~ https://denny.me
#
# ShinyCMS is free software; you can redistribute it and/or modify it under the terms of the GPL (version 2 or later)

inherit_from: .rubocop_todo.yml

require:
  - rubocop-performance
  - rubocop-rails
  - rubocop-rspec

# There's no point in having Rubocop look at JavaScript, images, shell scripts, etc.
# Also, rubocop really does not like the code generated by Rails and ActiveRecord.
AllCops:
  EnabledByDefault: true
  Exclude:
    - app/assets/**/*
    - bin/*
    - coverage/**/*
    - db/archived-migrations/*.rb
    - db/migrate/*.rb
    - db/schema.rb
    - docs/*
    - log/*
    - node_modules/**/*
    - plugins/*/db/migrate/*.rb
    - public/**/*
    - tmp/**/*
    - tools/**/*

# This breaks CI tests that run against older versions
Gemspec/RequiredRubyVersion:
  Enabled: false

# Disabling cops for a few lines here and there is handy
Style/DisableCopsWithinSourceCodeDirective:
  Enabled: false

# I prefer collect to map
Style/CollectionMethods:
  PreferredMethods:
    map: collect

# These are allowed and expected to contain long blocks
Metrics/BlockLength:
  Exclude:
    - Gemfile
    - app/models/concerns/*.rb
    - config/environments/*
    - config/routes.rb
    - lib/tasks/*.rake
    - plugins/*/spec/**/*.rb
    - plugins/*/config/routes.rb
    - spec/**/*.rb

# This config file is easier to understand laid out as it is, not as this cop wants it
Layout/MultilineArrayLineBreaks:
  Exclude:
    - config/initializers/html_sanitizer.rb

# Spec files with I18n.t calls in them are more readable with longer single lines
# than they are with shorter split lines, and the demo data file is auto-generated.
Layout/LineLength:
  Exclude:
    - spec/**/*.rb
    - plugins/*/spec/**/*.rb
    - db/demo_data.rb

# This method lets me put a feature flag check in front of user registrations. That seems quite useful to me.
Lint/UselessMethodDefinition:
  Exclude:
    - app/controllers/users/registrations_controller.rb

# I like chaining methods, it's aesthetically pleasing :-p
Performance/ChainArrayAllocation:
  Enabled: false

# This is the (hopefully helpful) 'how to create an admin account' message displayed after seed data loads
Rails/Output:
  Exclude:
    - db/seeds.rb

# This code is intentionally and helpfully rewriting a bit of HTML
Rails/OutputSafety:
  Exclude:
    - config/initializers/field_with_errors.rb

# There's no database activity in these before all blocks, so this cop doesn't apply
RSpec/BeforeAfterAll:
  Exclude:
    - spec/models/theme_spec.rb
    - spec/support/faker.rb

# Currently inclined to keep this approach, for readability etc
RSpec/DescribedClassModuleWrapping:
  Enabled: false

# Disabling these two for now (but open to discussion/persuasion on their merits)
RSpec/ExampleLength:
  Enabled: false
RSpec/MultipleExpectations:
  Enabled: false

# Disabling this allows 'compact' class names, e.g. Admin::PagesController
Style/ClassAndModuleChildren:
  Enabled: false

# I think this makes code significantly harder to read, personally
Style/ConditionalAssignment:
  Enabled: false

# The test is for a feature that parses a list of IP addresses; the demo data is demo data
Style/IpAddresses:
  Exclude:
    - db/demo_data.rb
    - spec/requests/admin_controller_spec.rb

# I'd rather use one style of regex everywhere, and this one is clearer when working with URLs:
# %r{/(path)/parts/} rather than /\/(path)\/parts\//
Style/RegexpLiteral:
  Enabled: false

# Whitespace Considered Helpful
Layout/ExtraSpacing:
  Enabled: false
Layout/SpaceAroundBlockParameters:
  Enabled: false
Layout/SpaceInsideArrayLiteralBrackets:
  EnforcedStyle: space
Layout/SpaceInsideBlockBraces:
  EnforcedStyle: space
Layout/SpaceInsideHashLiteralBraces:
  EnforcedStyle: space
  Exclude:
    - db/demo_data.rb
Layout/SpaceInsideParens:
  EnforcedStyle: space
  Exclude:
    - db/demo_data.rb
Layout/SpaceInsidePercentLiteralDelimiters:
  Enabled: false
Layout/SpaceInsideReferenceBrackets:
  Enabled: false

# Alignment also considered helpful. And aesthetically pleasing.
Layout/HashAlignment:
  EnforcedColonStyle: table
  EnforcedHashRocketStyle: table

# The demo data is autogenerated, and not really formatted with humans in mind.
# Maybe I could run it through prettify or something though...
Layout/FirstArrayElementIndentation:
  Exclude:
    - db/demo_data.rb
Layout/LeadingEmptyLines:
  Exclude:
    - db/demo_data.rb
Layout/SpaceAroundOperators:
  Exclude:
    - db/demo_data.rb
Style/FrozenStringLiteralComment:
  Exclude:
    - db/demo_data.rb
Style/NumericLiterals:
  Exclude:
    - db/demo_data.rb
Style/StringHashKeys:
  Exclude:
    - db/demo_data.rb
Style/StringLiterals:
  Exclude:
    - db/demo_data.rb

# Potentially fixable at some point...
Lint/NumberConversion:
  Enabled: false
Style/InlineComment:
  Enabled: false
Style/MissingElse:
  Enabled: false

# Enabling these leads to less readable code in my opinion
Layout/MultilineMethodArgumentLineBreaks:
  Enabled: false
Layout/SpaceBeforeBrackets:
  Enabled: false
Lint/ConstantResolution:
  Enabled: false
Style/MethodCallWithArgsParentheses:
  Enabled: false

# I don't want to put copyright notices on autogenerated files that I haven't touched
Style/Copyright:
  Enabled: false

# Just, no.
Style/DocumentationMethod:
  Enabled: false
